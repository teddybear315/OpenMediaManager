<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Open Media Manager - Web Interface</title>
    <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <h1 class="app-title">Open Media Manager</h1>
                <div class="header-actions">
                    <button id="scanBtn" class="btn btn-primary">Scan Media</button>
                    <button id="cleanupBtn" class="btn btn-secondary" title="Cleanup encoded files">Cleanup Encoded</button>
                    <button id="themeBtn" class="btn btn-secondary" title="Toggle theme">üåô</button>
                    <button id="settingsBtn" class="btn btn-secondary">Settings</button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="app-main">
            <!-- Media Library Section -->
            <section id="mediaSection" class="media-section">
                <div class="section-header">
                    <h2><span class="media-toggle">‚ñ∂</span>Media Library</h2>
                    <div class="section-actions">
                        <select id="filterStatus" class="select-control">
                            <option value="">All Files</option>
                            <option value="‚úÖ">Compliant</option>
                            <option value="‚ö†Ô∏è">Needs Re-encoding</option>
                            <option value="‚ÑπÔ∏è">Below Standard</option>
                            <option value="üîç">Scanning</option>
                            <option value="‚õî">Error</option>
                        </select>
                        <input type="text" id="searchInput" class="input-control" placeholder="Search files...">
                        <button id="selectAllBtn" class="btn btn-secondary">Select All</button>
                        <button id="encodeBtn" class="btn btn-primary">Encode Selected</button>
                        <button id="stopEncodingBtn" class="btn btn-danger">‚èπ Stop Encoding</button>
                    </div>
                </div>

                <div class="media-table-wrapper">
                    <table id="mediaTable" class="media-table">
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="selectAllCheckbox"></th>
                                <th>Filename</th>
                                <th>Status</th>
                                <th>Resolution</th>
                                <th>Codec</th>
                                <th>Bitrate</th>
                                <th>Duration</th>
                                <th>Size</th>
                            </tr>
                        </thead>
                        <tbody id="mediaTableBody">
                            <tr class="loading-row">
                                <td colspan="9">Loading media files...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Encoding Log Section -->
            <section id="logSection" class="log-section collapsed">
                <div class="section-header">
                    <h2><span class="log-toggle">‚ñ∂</span>Encoding Log</h2>
                    <div class="section-actions hidden">
                        <button id="clearLogBtn" class="btn btn-secondary">Clear Log</button>
                        <!-- <button id="stopEncodingBtn" class="btn btn-danger" disabled>Stop Encoding</button> -->
                    </div>
                </div>

                <!-- File Progress Bar -->
                <div id="fileProgressContainer">
                    <div class="progress-label-container">
                        <label id="fileProgressLabel">Ready to start...</label>
                    </div>
                    <div id="fileProgressBar" class="progress-bar">
                        <div id="fileProgressFill"></div>
                    </div>
                </div>

                <!-- Batch Progress Bar -->
                <div id="batchProgressContainer">
                    <div class="progress-label-container">
                        <label id="batchProgressLabel">Batch Progress</label>
                    </div>
                    <div id="batchProgressBar" class="progress-bar">
                        <div id="batchProgressFill"></div>
                    </div>
                </div>

                <!-- Statistics Area -->
                <div id="statisticsContainer">
                    <h4 class="statistics-header">Overall Statistics</h4>
                    <div id="statisticsLabel">No files processed yet</div>
                </div>

                <div id="encodingLog" class="encoding-log"></div>
            </section>
        </main>
    </div>

    <!-- Settings Dialog -->
    <div id="settingsDialog" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div>
                    <button class="settings-tab active" data-tab="general">General</button>
                    <button class="settings-tab" data-tab="quality">Quality Standards</button>
                </div>

                <form id="settingsForm">
                    <!-- GENERAL TAB -->
                    <div id="general-tab" class="settings-tab-content active">
                        <div class="form-group">
                            <label for="mediaPath">Media Path:</label>
                            <input type="text" id="mediaPath" class="input-control" required>
                        </div>

                        <div class="form-group">
                            <label for="scanThreads">Scan Threads:</label>
                            <input type="number" id="scanThreads" class="input-control" min="1" max="16" value="8">
                        </div>

                        <hr>

                        <h4>Preferred Languages</h4>
                        <p>Used for subtitle/audio checking and as defaults for stream filtering during encoding.</p>

                        <div class="form-group">
                            <label for="audioLangs">Audio Languages:</label>
                            <input type="text" id="audioLangs" class="input-control" placeholder="e.g., eng, jpn, spa">
                        </div>

                        <div class="form-group">
                            <label for="subtitleLangs">Subtitle Languages:</label>
                            <input type="text" id="subtitleLangs" class="input-control" placeholder="e.g., eng, jpn, spa">
                        </div>
                    </div>

                    <!-- QUALITY STANDARDS TAB -->
                    <div id="quality-tab" class="settings-tab-content">
                        <h4>Quality Standards (File Checking)</h4>
                        <p>These settings determine which files need re-encoding based on their current quality.</p>

                        <!-- Low-Res Settings -->
                        <fieldset>
                            <legend>Below 720p Bitrate Range</legend>
                            <div>
                                <div class="form-group">
                                    <label for="minLowRes">Min Bitrate:</label>
                                    <input type="number" id="minLowRes" class="input-control" value="500">
                                </div>
                                <div class="form-group">
                                    <label for="maxLowRes">Max Bitrate:</label>
                                    <input type="number" id="maxLowRes" class="input-control" value="1000">
                                </div>
                            </div>
                        </fieldset>

                        <!-- 720p Settings -->
                        <fieldset>
                            <legend>720p Bitrate Range</legend>
                            <div>
                                <div class="form-group">
                                    <label for="min720p">Min Bitrate:</label>
                                    <input type="number" id="min720p" class="input-control" value="1000">
                                </div>
                                <div class="form-group">
                                    <label for="max720p">Max Bitrate:</label>
                                    <input type="number" id="max720p" class="input-control" value="2000">
                                </div>
                            </div>
                        </fieldset>

                        <!-- 1080p Settings -->
                        <fieldset>
                            <legend>1080p Bitrate Range</legend>
                            <div>
                                <div class="form-group">
                                    <label for="min1080p">Min Bitrate:</label>
                                    <input type="number" id="min1080p" class="input-control" value="2000">
                                </div>
                                <div class="form-group">
                                    <label for="max1080p">Max Bitrate:</label>
                                    <input type="number" id="max1080p" class="input-control" value="4000">
                                </div>
                            </div>
                        </fieldset>

                        <!-- 1440p Settings -->
                        <fieldset>
                            <legend>1440p Bitrate Range</legend>
                            <div>
                                <div class="form-group">
                                    <label for="min1440p">Min Bitrate:</label>
                                    <input type="number" id="min1440p" class="input-control" value="4000">
                                </div>
                                <div class="form-group">
                                    <label for="max1440p">Max Bitrate:</label>
                                    <input type="number" id="max1440p" class="input-control" value="6000">
                                </div>
                            </div>
                        </fieldset>

                        <!-- 4K Settings -->
                        <fieldset>
                            <legend>4K Bitrate Range</legend>
                            <div>
                                <div class="form-group">
                                    <label for="min4k">Min Bitrate:</label>
                                    <input type="number" id="min4k" class="input-control" value="6000">
                                </div>
                                <div class="form-group">
                                    <label for="max4k">Max Bitrate:</label>
                                    <input type="number" id="max4k" class="input-control" value="10000">
                                </div>
                            </div>
                        </fieldset>

                        <hr>

                        <h4>Asset Checking</h4>

                        <div class="form-group">
                            <label for="subtitleCheck">Subtitle Check:</label>
                            <select id="subtitleCheck" class="input-control">
                                <option value="ignore">Ignore</option>
                                <option value="warning">Warning (add to issues)</option>
                                <option value="needs_reencoding">Needs Re-encoding (if missing)</option>
                                <option value="below_standard">Below Standard (if missing)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="coverArtCheck">Cover Art Check:</label>
                            <select id="coverArtCheck" class="input-control">
                                <option value="ignore">Ignore</option>
                                <option value="warning">Warning (add to issues)</option>
                                <option value="needs_reencoding">Needs Re-encoding (if missing)</option>
                                <option value="below_standard">Below Standard (if missing)</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button id="cancelSettingsBtn" class="btn btn-secondary">Cancel</button>
                <button id="saveSettingsBtn" class="btn btn-primary">Save Settings</button>
            </div>
        </div>
    </div>

    <!-- Confirm Dialog -->
    <div id="confirmDialog" class="modal-overlay">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2 id="confirmTitle">Confirm</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p id="confirmMessage"></p>
            </div>
            <div class="modal-footer">
                <button id="confirmCancelBtn" class="btn btn-secondary">Cancel</button>
                <button id="confirmOkBtn" class="btn btn-primary">OK</button>
            </div>
        </div>
    </div>

    <!-- Alert Dialog -->
    <div id="alertDialog" class="modal-overlay">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2 id="alertTitle">Alert</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p id="alertMessage"></p>
            </div>
            <div class="modal-footer">
                <button id="alertOkBtn" class="btn btn-primary">OK</button>
            </div>
        </div>
    </div>

    <!-- Encoding Settings Dialog -->
    <div id="encodingSettingsDialog" class="modal-overlay">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>Encoding Settings</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div>
                    <!-- LEFT COLUMN -->
                    <div>
                        <h3>Profile</h3>
                        <div class="form-group">
                            <label>Encoding Profile:</label>
                            <div class="profile-button-group">
                                <select id="encProfile">
                                    <option value="">Default</option>
                                </select>
                                <button type="button" id="encSaveProfile" class="btn">Save</button>
                                <button type="button" id="encDeleteProfile" class="btn">Delete</button>
                            </div>
                        </div>

                        <h3>Video Encoding</h3>
                        <div class="form-group">
                            <label for="encCodec">Codec:</label>
                            <select id="encCodec">
                                <option value="x265">x265 (HEVC)</option>
                                <option value="av1">AV1</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="encPreset">Preset:</label>
                            <select id="encPreset">
                                <option value="ultrafast">Ultrafast</option>
                                <option value="superfast">Superfast</option>
                                <option value="veryfast" selected>Veryfast</option>
                                <option value="faster">Faster</option>
                                <option value="fast">Fast</option>
                                <option value="medium">Medium</option>
                                <option value="slow">Slow</option>
                                <option value="slower">Slower</option>
                                <option value="veryslow">Veryslow</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="encCQ">Quality (CQ):</label>
                            <input type="number" id="encCQ" min="0" max="51" value="22">
                        </div>

                        <div class="form-group">
                            <label for="encLevel">Level:</label>
                            <select id="encLevel">
                                <option value="">Auto (ignore)</option>
                                <option value="3.0">3.0</option>
                                <option value="3.1">3.1</option>
                                <option value="4.0">4.0</option>
                                <option value="4.1" selected>4.1</option>
                                <option value="5.0">5.0</option>
                                <option value="5.1">5.1</option>
                                <option value="5.2">5.2</option>
                                <option value="6.0">6.0</option>
                                <option value="6.1">6.1</option>
                                <option value="6.2">6.2</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="encBitDepth">Bit Depth:</label>
                            <select id="encBitDepth">
                                <option value="source" selected>Match source</option>
                                <option value="force_8bit">Force 8-bit</option>
                                <option value="force_10bit">Force 10-bit</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label><input type="checkbox" id="encUseGPU"> Use GPU (NVENC)</label>
                        </div>

                        <div class="form-group">
                            <label for="encThreads">Thread Count:</label>
                            <input type="number" id="encThreads" min="1" max="32" value="4">
                        </div>

                        <div class="form-group">
                            <label><input type="checkbox" id="encTuneAnimation"> Tune for animation</label>
                        </div>

                        <h3>Skip Options</h3>
                        <div class="form-group">
                            <label><input type="checkbox" id="encSkipVideo"> Skip video encoding (copy stream)</label>
                        </div>
                        <div class="form-group">
                            <label><input type="checkbox" id="encSkipAudio"> Skip audio encoding (copy stream)</label>
                        </div>
                        <div class="form-group">
                            <label><input type="checkbox" id="encSkipSubs"> Skip subtitle processing (copy stream)</label>
                        </div>
                        <div class="form-group">
                            <label><input type="checkbox" id="encSkipCoverArt" checked> Skip cover art / attached pictures</label>
                        </div>

                        <h3>Language Filtering</h3>
                        <div class="form-group">
                            <label><input type="checkbox" id="encFilterAudio"> Filter audio tracks by language</label>
                        </div>
                        <div class="form-group" id="encAudioLangsGroup">
                            <label for="encAudioLangs">Audio Languages:</label>
                            <input type="text" id="encAudioLangs" placeholder="e.g., eng, jpn, spa">
                        </div>

                        <div class="form-group">
                            <label><input type="checkbox" id="encFilterSubs"> Filter subtitle tracks by language</label>
                        </div>
                        <div class="form-group" id="encSubsLangsGroup">
                            <label for="encSubLangs">Subtitle Languages:</label>
                            <input type="text" id="encSubLangs" placeholder="e.g., eng, jpn, spa">
                        </div>
                    </div>

                    <!-- RIGHT COLUMN -->
                    <div>
                        <h3>Bitrate Settings</h3>

                        <div class="form-group">
                            <label><input type="checkbox" id="encUseMinMaxBitrate"> Use Min/Max Bitrate Limits</label>
                        </div>

                        <div class="form-group">
                            <label><input type="checkbox" id="encUseTargetBitrate"> Use Target Bitrate (disables CQ)</label>
                        </div>

                        <div id="bitrateSettingsContainer">
                            <!-- Low Resolution -->
                            <div id="lowResBitrateGroup">
                                <h4>Below 720p</h4>
                                <div class="form-group">
                                    <label for="encMinLowRes">Min (kbps):</label>
                                    <input type="number" id="encMinLowRes" value="500">
                                </div>
                                <div class="form-group">
                                    <label for="encMaxLowRes">Max (kbps):</label>
                                    <input type="number" id="encMaxLowRes" value="1000">
                                </div>
                                <div class="form-group" id="encTargetLowResGroup">
                                    <label for="encTargetLowRes">Target (kbps):</label>
                                    <input type="number" id="encTargetLowRes" value="800">
                                </div>
                            </div>

                            <!-- 720p -->
                            <div id="res720pBitrateGroup">
                                <h4>720p</h4>
                                <div class="form-group">
                                    <label for="encMin720p">Min (kbps):</label>
                                    <input type="number" id="encMin720p" value="1000">
                                </div>
                                <div class="form-group">
                                    <label for="encMax720p">Max (kbps):</label>
                                    <input type="number" id="encMax720p" value="2000">
                                </div>
                                <div class="form-group" id="encTarget720pGroup">
                                    <label for="encTarget720p">Target (kbps):</label>
                                    <input type="number" id="encTarget720p" value="1500">
                                </div>
                            </div>

                            <!-- 1080p -->
                            <div id="res1080pBitrateGroup">
                                <h4>1080p</h4>
                                <div class="form-group">
                                    <label for="encMin1080p">Min (kbps):</label>
                                    <input type="number" id="encMin1080p" value="2000">
                                </div>
                                <div class="form-group">
                                    <label for="encMax1080p">Max (kbps):</label>
                                    <input type="number" id="encMax1080p" value="4000">
                                </div>
                                <div class="form-group" id="encTarget1080pGroup">
                                    <label for="encTarget1080p">Target (kbps):</label>
                                    <input type="number" id="encTarget1080p" value="3000">
                                </div>
                            </div>

                            <!-- 1440p -->
                            <div id="res1440pBitrateGroup">
                                <h4>1440p</h4>
                                <div class="form-group">
                                    <label for="encMin1440p">Min (kbps):</label>
                                    <input type="number" id="encMin1440p" value="4000">
                                </div>
                                <div class="form-group">
                                    <label for="encMax1440p">Max (kbps):</label>
                                    <input type="number" id="encMax1440p" value="6000">
                                </div>
                                <div class="form-group" id="encTarget1440pGroup">
                                    <label for="encTarget1440p">Target (kbps):</label>
                                    <input type="number" id="encTarget1440p" value="5000">
                                </div>
                            </div>

                            <!-- 4K -->
                            <div id="res4kBitrateGroup">
                                <h4>4K</h4>
                                <div class="form-group">
                                    <label for="encMin4k">Min (kbps):</label>
                                    <input type="number" id="encMin4k" value="6000">
                                </div>
                                <div class="form-group">
                                    <label for="encMax4k">Max (kbps):</label>
                                    <input type="number" id="encMax4k" value="10000">
                                </div>
                                <div class="form-group" id="encTarget4kGroup">
                                    <label for="encTarget4k">Target (kbps):</label>
                                    <input type="number" id="encTarget4k" value="8000">
                                </div>
                            </div>
                        </div>

                        <h3>Post-Encode Cleanup</h3>
                        <div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="encAutoRemoveBroken" checked>
                                    <span>
                                        <strong>Auto-remove broken/expanded files</strong><br>
                                        <small>Automatically delete encoded files that are larger than the original or failed to encode properly</small>
                                    </span>
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="encAutoMoveSmaller">
                                    <span>
                                        <strong>Auto-move smaller files to replace originals</strong><br>
                                        <small>Automatically replace original files with smaller encoded versions (deletes originals)</small>
                                    </span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="encCancelBtn" class="btn btn-secondary">Cancel</button>
                <button id="encStartBtn" class="btn btn-primary">Start Encoding</button>
            </div>
        </div>
    </div>

    <!-- Encoding Stopped Dialog -->
    <div id="encodingStoppedModal" class="modal">
        <div class="modal-dialog">
            <div class="modal-header">
                <h2>Encoding Stopped</h2>
                <button class="modal-close" onclick="closeEncodingStoppedDialog()">&times;</button>
            </div>
            <div class="modal-body">
                <p>Encoding was stopped.</p>
                <div id="stoppedStatsDiv">
                    <p><strong>Successful:</strong> <span id="stoppedSuccessful">0</span></p>
                    <p><strong>Cancelled:</strong> <span id="stoppedCancelled">0</span></p>
                    <p><strong>Failed:</strong> <span id="stoppedFailed">0</span></p>
                </div>
                <div id="partialFilesSection">
                    <p><strong>Found <span id="partialFileCount">0</span> partial encoded file(s).</strong></p>
                    <p>Would you like to delete these partial files?</p>
                </div>
            </div>
            <div class="modal-footer">
                <button id="deletePartialBtn" class="btn btn-danger" onclick="deletePartialFiles()">Delete Partial Files</button>
                <button class="btn btn-secondary" onclick="closeEncodingStoppedDialog()">Close</button>
            </div>
        </div>
    </div>

    <script src="/static/js/utils.js"></script>
    <script src="/static/js/dialogs.js"></script>
    <script src="/static/js/main.js"></script>
</body>
</html>
